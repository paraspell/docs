import{_ as t,o as r,c as a,ag as o}from"./chunks/framework.BYehg5q7.js";const u=JSON.parse('{"title":"Deploy API on your server üíª","description":"","frontmatter":{},"headers":[],"relativePath":"api/deploy.md","filePath":"api/deploy.md"}'),s={name:"api/deploy.md"};function n(i,e,d,l,c,h){return r(),a("div",null,[...e[0]||(e[0]=[o(`<h1 id="deploy-api-on-your-server-üíª" tabindex="-1">Deploy API on your server üíª <a class="header-anchor" href="#deploy-api-on-your-server-üíª" aria-label="Permalink to &quot;Deploy API on your server üíª&quot;">‚Äã</a></h1><p>To deploy our API on your server you only need to create a <code>.env</code> file and fill it with your secret phrase to allow for token autentification. This file should be located in the root folder. You can also set request limits in that file.</p><h3 id="before-you-begin" tabindex="-1">Before you begin: <a class="header-anchor" href="#before-you-begin" aria-label="Permalink to &quot;Before you begin:&quot;">‚Äã</a></h3><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p>‚ö†Ô∏è Latest version of API migrated to Prisma, so to connect to the database, only the database_url parameter is needed.</p><p>‚ö†Ô∏è Since migration to Prisma, POSTGRESQL is no longer the only database that works. However provider needs to be replaced in prisma.schema file.</p><p>‚ö†Ô∏è Make sure to also test every form before deploying to ensure everything is configured correctly.</p></div><h2 id="env-file" tabindex="-1">.env file <a class="header-anchor" href="#env-file" aria-label="Permalink to &quot;.env file&quot;">‚Äã</a></h2><p>The example file should look like this:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>RATE_LIMIT_TTL_SEC=60 </span></span>
<span class="line"><span>RATE_LIMIT_REQ_COUNT_PUBLIC=20</span></span>
<span class="line"><span>RATE_LIMIT_REQ_COUNT_AUTH=100</span></span>
<span class="line"><span>JWT_SECRET_KEY=YourSecretPhrase</span></span>
<span class="line"><span>RECAPTCHA_SECRET_KEY=YourRecaptchaSecretKey</span></span>
<span class="line"><span>PORT=YourHTTPServerPort</span></span>
<span class="line"><span>DATABASE_URL=&quot;yourDbUrl&quot;</span></span>
<span class="line"><span>EMAIL_ADDRESS_SENDER=sender@gmail.com</span></span>
<span class="line"><span>EMAIL_ADDRESS_RECIPIENT_ARR=admin1@gmail.com,admin2@gmail.com</span></span>
<span class="line"><span>EMAIL_CLIENT_ID=YourClientId</span></span>
<span class="line"><span>EMAIL_CLIENT_SECRET=YourClientSecret</span></span>
<span class="line"><span>EMAIL_REDIRECT_URI=YourRedirectUri</span></span>
<span class="line"><span>EMAIL_REFRESH_TOKEN=YourClientRefreshToken</span></span>
<span class="line"><span>MIXPANEL_PROJECT_TOKEN=YourMixPanelToken</span></span>
<span class="line"><span>SENTRY_DSN=YourSentryToken</span></span></code></pre></div><p>Each variable listed below <strong>must be configured</strong> unless explicitly marked as optional. The API will not start if required variables are missing.</p><table tabindex="0"><thead><tr><th>Variable Name</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>RATE_LIMIT_TTL_SEC</code></td><td>Specifies the time window (in seconds) before the request counter is reset.</td><td>Yes</td></tr><tr><td><code>RATE_LIMIT_REQ_COUNT_PUBLIC</code></td><td>Defines the maximum number of requests allowed within the specified time window for unauthenticated requests.</td><td>Yes</td></tr><tr><td><code>RATE_LIMIT_REQ_COUNT_AUTH</code></td><td>Defines the maximum number of requests allowed within the specified time window for authenticated requests.</td><td>Yes</td></tr><tr><td><code>JWT_SECRET_KEY</code></td><td>Secret key used to derive and validate JWT tokens (Defined by you, can be any string). Must be set before the server starts.</td><td>Yes</td></tr><tr><td><code>RECAPTCHA_SECRET_KEY</code></td><td>Secret key for Google reCAPTCHA. Ensure <strong>reCAPTCHA v3</strong> is selected when generating the key. (Guide on how to <a href="https://docs.cloud.google.com/recaptcha/docs/create-key-website?fbclid=IwAR0wbzgUfKo-ih12jfNAC8MJIUUEMX15vszzfMdwvizXgqBdcrQW_9nCtx4" target="_blank" rel="noreferrer">obtain</a>)</td><td>Yes</td></tr><tr><td><code>PORT</code></td><td>Port on which the API server runs. Defaults to <code>3001</code> if not provided.</td><td>No</td></tr><tr><td><code>DATABASE_URL</code></td><td>Database connection URL. Refer to the <a href="https://www.prisma.io/docs/orm/reference/connection-urls#env" target="_blank" rel="noreferrer">documentation</a> for instructions on generating this value.</td><td>Yes</td></tr><tr><td><code>EMAIL_ADDRESS_SENDER</code></td><td>Email address used to send responses to submitted forms.</td><td>Yes</td></tr><tr><td><code>EMAIL_ADDRESS_RECIPIENT_ARR</code></td><td>One or more email addresses that receive submitted form responses.</td><td>Yes</td></tr><tr><td><code>EMAIL_CLIENT_ID</code></td><td>OAuth client ID required by Nodemailer. (Guide on how to <a href="https://dev.to/chandrapantachhetri/sending-emails-securely-using-node-js-nodemailer-smtp-gmail-and-oauth2-g3a" target="_blank" rel="noreferrer">obtain</a>.)</td><td>Yes</td></tr><tr><td><code>EMAIL_CLIENT_SECRET</code></td><td>OAuth client secret required by Nodemailer. (Guide on how to <a href="https://dev.to/chandrapantachhetri/sending-emails-securely-using-node-js-nodemailer-smtp-gmail-and-oauth2-g3a" target="_blank" rel="noreferrer">obtain</a>.)</td><td>Yes</td></tr><tr><td><code>EMAIL_REDIRECT_URI</code></td><td>OAuth redirect URI required by Nodemailer. (Guide on how to <a href="https://dev.to/chandrapantachhetri/sending-emails-securely-using-node-js-nodemailer-smtp-gmail-and-oauth2-g3a" target="_blank" rel="noreferrer">obtain</a>.)</td><td>Yes</td></tr><tr><td><code>EMAIL_REFRESH_TOKEN</code></td><td>OAuth refresh token required by Nodemailer. (Guide on how to <a href="https://dev.to/chandrapantachhetri/sending-emails-securely-using-node-js-nodemailer-smtp-gmail-and-oauth2-g3a" target="_blank" rel="noreferrer">obtain</a>.)</td><td>Yes</td></tr><tr><td><code>MIXPANEL_PROJECT_TOKEN</code></td><td>Token used for request-level analytics (no amounts or wallet addresses are stored).</td><td>No</td></tr><tr><td><code>SENTRY_DSN</code></td><td>DSN token for Sentry error tracking and debugging.</td><td>No</td></tr></tbody></table><p>If you have configured everything correctly, you should receive emails similar to the one showcased below. These should be received at the email addresses you specified in the <code>EMAIL_ADDRESS_RECIPIENT_ARR</code> configuration line.</p><img width="784" alt="Screenshot 2023-08-21 at 22 40 34" src="https://user-images.githubusercontent.com/55763425/262149103-cb3398c0-b186-452f-bb67-b8aac9608173.png"><p>Based on the UserID received in the email you can edit the maximum request amount for a specific API key.</p><div class="note custom-block github-alert"><p class="custom-block-title">Database overrides maximum request count.</p><p>If the value is left on <code>null</code>, the user can generate a default of 100 requests per minute just like before, as a Captcha-verified user.</p></div><img width="437" alt="Screenshot 2023-08-21 at 21 58 57" src="https://user-images.githubusercontent.com/55763425/262140588-8353a1a5-e4be-4be7-92bd-a37cfe26ca39.png"><h2 id="setting-up-sentry" tabindex="-1">Setting up Sentry <a class="header-anchor" href="#setting-up-sentry" aria-label="Permalink to &quot;Setting up Sentry&quot;">‚Äã</a></h2><p>Recently, LightSpell introduced the Sentry error tracking service implementation. This guide covers how to use it.</p><ul><li>First step is to register at this <a href="https://sentry.io/lcome/" target="_blank" rel="noreferrer">website</a>.</li><li>Create a new project to get the DSN token for the .env file used by LightSpell</li></ul><img width="420" alt="Screenshot 2023-11-16 at 10 23 28" src="https://user-images.githubusercontent.com/55763425/283396658-98339f19-04ab-4ee8-9dfa-a0efec722e73.png"><ul><li>Monitor your issues through the dashboard. If you receive any unhandled issues, you should be notified by email also</li></ul><h3 id="how-to-trigger-sentry-test-error" tabindex="-1">How to trigger Sentry test error <a class="header-anchor" href="#how-to-trigger-sentry-test-error" aria-label="Permalink to &quot;How to trigger Sentry test error&quot;">‚Äã</a></h3><p>Open your REST API client, client we use is <a href="https://insomnia.rest/" target="_blank" rel="noreferrer">Insomnia</a>.</p><p>Paste in the following details and input the following link to test out Sentry: <code>http://localhost:3001/v5/sentry-test</code></p><p>LightSpell has integrated this test for you so you can test out error 500 in localhost mode. Once you paste the link into the browser, Sentry should notify you about a new error 500. It should look like this in your project:</p><img width="1223" alt="SniÃÅmka obrazovky 2024-03-08 o 19 16 35" src="https://gist.github.com/assets/55763425/c342e184-a7df-4a58-ad70-9d08fd7c59ff"><p>You can see that the exact line where the error was triggered is shown, and you can even try to ask AI for help with resolving the task for you.</p><p>This confirms that the sentry is working correctly.</p>`,26)])])}const m=t(s,[["render",n]]);export{u as __pageData,m as default};
